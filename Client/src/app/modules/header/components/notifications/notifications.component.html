<div ngbDropdown (openChange)="counts = 0">
  <a
    class="nav-link-icon grayIcon pr-3"
    style="padding-left: 0.75rem !important;"
    routerLinkActive="active"
    id="notificationsDropdown"
    ngbDropdownToggle
  >
    <fa-icon
      [icon]="['fas', 'bell']"
      class="navigationIcon"
      container="body"
      style="padding-bottom: 10px;"
      ngbTooltip="{{ 'Nav.Notifications' | translationPipe }}"
      placement="bottom"
    ></fa-icon>
    <span class="badge badge-danger navNotificationCounter">{{
      counts !== 0 ? counts : ''
    }}</span>
  </a>
  <div
    ngbDropdownMenu
    aria-labelledby="notificationsDropdown"
    class="shadow-lg navNotificationsDropdown pt-0 mt-0"
  >
    <div
      class="bg-light border-bottom pt-1 pb-1"
      *ngIf="notifications.today.data.length !== 0"
    >
      <label class="small bold text-muted pl-3">
        {{ 'Nav.NewNotifications' | translationPipe }}
      </label>
    </div>
    <div
      aria-labelledby="notificationsDropdown"
      class="search-result setNotificationHeight"
      infiniteScroll
      [infiniteScrollDistance]="scrollDownDistance"
      (scrolled)="fetchData()"
      [scrollWindow]="false"
    >
      <a
        ngbDropdownItem
        *ngFor="let notification of notifications.today.data"
        class="pl-1 border-bottom"
        [ngClass]="{ unread: notification.isRead === 0 }"
        (click)="markRead(notification)"
      >
        <div class="media">
          <fa-icon
            *ngIf="notification.actorUserName == 'Anonymous'"
            style="width: 50px; height: 50px;"
            [icon]="['fas', 'ghost']"
            class="anonymousUser rounded-circle mr-3 ml-2 mt-2"
          >
          </fa-icon>
          <img
            *ngIf="isAutoGenerated(notification)"
            class="rounded-circle mr-3 ml-2 mt-2"
            style="width: 50px; height: 50px;"
            [defaultImage]="defaultImage"
            [lazyLoad]="
              'https://ideawake-test.s3.us-east-2.amazonaws.com/assets/media/innobot.jpg'
            "
          />
          <img
            *ngIf="
              !isAutoGenerated(notification) &&
              notification.actorUserName != 'Anonymous'
            "
            class="rounded-circle mr-3 ml-2 mt-2"
            style="width: 50px; height: 50px;"
            [src]="todayUserProfileImages[notification.actorUserId]"
          />
          <div class="media-body">
            <!-- Today Not Aggregated -->
            <p
              class="mb-1 pt-2 notificationTextSize text-wrap"
              *ngIf="!notification.aggregatedCount"
            >
              <b>{{ notification.actorUserName }}</b>
              <span [innerHtml]="generateText(notification)"></span>
            </p>
            <!-- Today Aggregated -->
            <p
              *ngIf="notification.aggregatedCount"
              class="mb-1 pt-2 notificationTextSize text-wrap"
            >
              <app-social-images></app-social-images>
              <span [innerHtml]="aggregatedNotification(notification)"></span>
            </p>
            <p class="small text-muted mb-2">
              <fa-icon [icon]="['fas', 'clock']"></fa-icon>
              {{ notification.createdAt | timeAgo }}
            </p>
          </div>
        </div>
      </a>
      <div
        class="bg-light border-bottom pt-1 pb-1"
        *ngIf="notifications.past.data.length !== 0"
      >
        <label class="small bold text-muted pl-3">
          {{ 'Nav.EarlierNotifications' | translationPipe }}
        </label>
      </div>
      <a
        ngbDropdownItem
        *ngFor="let notification of notifications.past.data"
        class="pl-1 border-bottom"
        [ngClass]="{ unread: notification.isRead === 0 }"
        (click)="markRead(notification)"
      >
        <div class="media">
          <fa-icon
            *ngIf="notification.actorUserName == 'Anonymous'"
            style="width: 50px; height: 50px;"
            [icon]="['fas', 'ghost']"
            class="anonymousUser rounded-circle mr-3 ml-2 mt-2"
          >
          </fa-icon>
          <img
            *ngIf="isAutoGenerated(notification)"
            class="rounded-circle mr-3 ml-2 mt-2"
            style="width: 50px; height: 50px;"
            [defaultImage]="defaultImage"
            [lazyLoad]="
              'https://ideawake-test.s3.us-east-2.amazonaws.com/assets/media/innobot.jpg'
            "
          />
          <img
            *ngIf="
              !isAutoGenerated(notification) &&
              notification.actorUserName != 'Anonymous'
            "
            class="rounded-circle mr-3 ml-2 mt-2"
            style="width: 50px; height: 50px;"
            [src]="pastUserProfileImages[notification.actorUserId]"
          />
          <div class="media-body">
            <!-- Past Not Aggregated -->
            <p
              class="mb-1 pt-2 notificationTextSize text-wrap"
              *ngIf="!notification.aggregatedCount"
            >
              <b>{{ notification.actorUserName }}</b>
              <span [innerHtml]="generateText(notification)"></span>
            </p>
            <!-- Past Aggregated -->
            <p
              *ngIf="notification.aggregatedCount"
              class="mb-1 pt-2 notificationTextSize text-wrap"
            >
              <app-social-images></app-social-images>
              <span [innerHtml]="aggregatedNotification(notification)"></span>
            </p>
            <p class="small text-muted mb-2">
              <fa-icon [icon]="['fas', 'clock']"></fa-icon>
              {{ notification.createdAt | timeAgo }}
            </p>
          </div>
        </div>
      </a>
      <!-- <button ngbDropdownItem class="unread pl-1 border-bottom">
        <div class="media">
          <img
            class="rounded-circle mr-3 ml-2 mt-2"
            src="https://via.placeholder.com/40x40"
          />
          <div class="media-body">
            <p class="mb-1 pt-2 notificationTextSize text-wrap">
              <b>FirstLastName</b> linked insightname to ideaname
            </p>
            <p class="small text-muted mb-2">
              <fa-icon [icon]="['fas', 'clock']"></fa-icon> 8 hours ago
            </p>
          </div>
        </div>
      </button> -->
    </div>
    <div style="text-align: center;">
      <fa-icon
        *ngIf="isLoading"
        [icon]="['fas', 'spinner']"
        [spin]="true"
      ></fa-icon>
    </div>
    <!-- no notifications -->
    <div class="py-4 text-center" *ngIf="!actualCounts && !isLoading">
      <fa-icon
        [icon]="['fas', 'bell-slash']"
        class="iconLarge text-muted mb-3"
      ></fa-icon>
      <p class="text-muted mb-0 mt-2">
        {{ 'Nav.NoNotifications' | translationPipe }}
      </p>
    </div>
    <!-- no notifications -->
    <!-- <div
      class="bg-light text-center border-bottom pt-1 pb-1"
      *ngIf="actualCounts"
    >
      <label class="small bold pl-3 link">See All Notifications</label>
    </div> -->
  </div>
</div>
